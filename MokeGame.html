<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>MokeSell</title>
    <link rel="icon" href="Images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navbar -->
    <header class="topbar">
        <nav class="navbar">
            <!-- Logo on the right -->
            <div class="logo">
                <a href="index.html">
                    <img src="Images/MokeSell_logo.png" alt="Logo">
                </a>
            </div>            

            <div class="nav-links">
                <div class="categories-btn">
                    <button class="categories-toggle-btn" onclick="toggleMenu()">
                        <span class="hamburger">&#9776;</span> Categories
                    </button>
                    <div id="dropdownMenu" class="dropdown-menu">
                        <a href="#" data-category="Free Items">
                            <img src="Images/free.png" alt="Free Items" class="dropdown-img">
                            Free Items
                        </a>
                        <a href="#" data-category="Women's Fashion">
                            <img src="Images/women_fashion.png" alt="Women's Fashion" class="dropdown-img">
                            Women's Fashion
                        </a>
                        <a href="#" data-category="Men's Fashion">
                            <img src="Images/men_fashion.png" alt="Men's Fashion" class="dropdown-img">
                            Men's Fashion
                        </a>
                        <a href="#" data-category="Beauty & Health">
                            <img src="Images/cosmetics.png" alt="Beauty & Health" class="dropdown-img">
                            Beauty & Health
                        </a>
                        <a href="#" data-category="Electronics">
                            <img src="Images/gadgets.png" alt="Electronics" class="dropdown-img">
                            Electronics
                        </a>
                        <a href="#" data-category="Babies & Kids">
                            <img src="Images/baby.png" alt="Babies & Kids" class="dropdown-img">
                            Babies & Kids
                        </a>
                        <a href="#" data-category="Learning & Enrichment">
                            <img src="Images/learning.png" alt="Learning & Enrichment" class="dropdown-img">
                            Learning & Enrichment
                        </a>
                        <a href="#" data-category="Services">
                            <img src="Images/services.png" alt="Services" class="dropdown-img">
                            Services
                        </a>
                        <a href="#" data-category="Others">
                            <img src="Images/application.png" alt="Others" class="dropdown-img">
                            Others
                        </a>
                    </div>
                </div>

                <div class="icons">
                    <a href="following.html" class="protected-link">
                        <img src="Images/add-friend.png" alt="Favourites">
                    </a>
                    <a href="favourites.html" class="protected-link">
                        <img src="Images/favourites.png" alt="Favourites">
                    </a>
                    
                    <button class="notificationBtn" style="border: 0; background-color: white;">
                        <img src="Images/notification.png">
                    </button>

                    <!--  Slide-Out Notification -->
                    <div id="notificationBar">
                        <span class="close-button" onclick="hideNotification()"><img src="Images/close.png"></span>
                        <p><strong>Notification</strong></p>
                    </div>

                    <a href="chats.html" class="protected-link">
                        <img src="Images/messages.png" alt="Chats">
                    </a>
                    <a href="MokeGame.html" class="protected-link">
                        <img src="Images/game.png" alt="MokeFarm" style="width:40px;height:40px;">
                    </a>
                </div>
                

                <div class="auth-buttons">
                    <button id="openModalBtn" class="login-btn">Login</button>

                    <div id="profilePicContainer" style="display: none; align-items: center;">
                        <img id="profilePic" src="" alt="Profile Picture" />
                        <div id="profileDropdownMenu" class="dropdown-menu" style="display: none;">
                            <a href="profile.html">Profile</a>
                            <a href="settings.html">Settings</a>
                            <a href="logout.html" id="logoutLink">Logout</a>
                        </div>
                    </div>
                              
                    <a href="sell.html"><button class="sell-btn">Sell</button></a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Search Bar Section -->
    <div class="search-container" style="padding-top: 90px;">
        <input type="text" id="search-bar" class="search-bar" placeholder="Search for something">
        <!-- Category Filter Dropdown -->
        <select id="category-filter" class="category-filter">
            <option value="">All Categories</option>
            <option value="Free Items">Free Items</option>
            <option value="Women's Fashion">Women's Fashion</option>
            <option value="Men's Fashion">Men's Fashion</option>
            <option value="Electronics">Electronics</option>
            <option value="Babies & Kids">Babies & Kids</option>
            <option value="Learning & Enrichment">Learning & Enrichment</option>
            <option value="Services">Services</option>
            <option value="Others">Others</option>
        </select>
        <button id="search-btn" class="search-btn">Search</button>
    </div>

    <!-- Login Modal (popup) -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <!-- Close Button -->
            <span class="close-btn" id="closeModalBtn">&times;</span>
            
            <!-- Title -->
            <h2>Login</h2>
            
            <!-- Form -->
            <form id = "loginForm">
                <!-- Email Address -->
                <label for="email">Email Address:</label>
                <input type="email" id="email" name="email" placeholder="Enter your email" required>
                
                <!-- Password -->
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" placeholder="Enter your password" required>
                <a href="#" class="forgot-password">Forgot Password?</a>
                
                <!-- Sign In Button -->
                <button type="submit" class="btn">Sign In</button>
            </form>
            
            <!-- Create Account -->
            <p class="create-account">
                Don't have an account yet? <a href="#" id="createAccountLink" class="create-account-link">Create Account</a>
            </p>        
        </div>
    </div>

    <!-- Login Successful Modal (pop-up) -->
    <div id="loginSuccessModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeLoginSuccessModal">&times;</span>
            <h2>Login Successful!</h2>
            
            <!-- Lottie Animation for Successful Login -->
            <dotlottie-player id="login-success-animation" src="https://lottie.host/07d2015e-12bd-4b20-95b3-add530a01150/GJJ27JsCtB.lottie" background="transparent" speed="1" loop autoplay style="width: 200px; height: 200px;"></dotlottie-player>
        </div>
    </div>


    <!-- Register Modal (popup) -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeRegisterModalBtn">&times;</span>
            <h2>Register</h2>
            <form id="add-contact-form">
                <label for="username">Username</label>
                <input type="text" id="signupusername" name="username" placeholder="Enter your username" required>
                
                <label for="register-email">Email Address</label>
                <input type="email" id="signupemail" name="email" placeholder="Enter your email" required>
                
                <label for="register-password">Password</label>
                <input type="password" id="signuppassword" name="password" placeholder="Enter your password" required>
                
                <label for="confirm-password">Confirm Password</label>
                <input type="password" id="confirm-password" name="confirm-password" placeholder="Confirm your password" required>
            
                <button type="submit" id="contact-submit" class="btn">Sign Up</button>
            </form>
            
            <p class="login-account">
                Already have an account? <a href="#" id="loginAccountLink" class="login-account-link">Login Account</a>
            </p>     
        </div>
    </div>

    <!-- Logout Modal -->
    <div id="logoutConfirmModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeLogoutConfirmModal">&times;</span>
            <h2>Are you sure you want to log out?</h2>
            <p>Do you really really really want to logout T^T</p>
            
            <!-- Buttons for confirming or canceling logout -->
            <div class="button-container">
                <button id="confirmLogoutBtn" class="confirm-btn">Log Out</button>
                <button id="cancelLogoutBtn" class="cancel-btn">Return</button>
            </div>
        </div>
        <!-- Lottie Animation for Logout -->
        <div class="lottie-container">
            <dotlottie-player id="logout-success-animation" src="https://lottie.host/e3b62f0f-8633-4ec0-bbc5-90d056caa7ab/TRpEZMtPA6.lottie" background="transparent" speed="1" loop autoplay style="width: 100px; height: 100px;"></dotlottie-player>
        </div>
    </div>

    <!-- Log Out Successful Modal (pop-up) -->
    <div id="logoutSuccessModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeLogOutSuccessModal">&times;</span>
            <h2>Log Out Successful!</h2>
            
            <!-- Lottie Animation for Successful Log Out -->
            <dotlottie-player id="login-success-animation" src="https://lottie.host/07d2015e-12bd-4b20-95b3-add530a01150/GJJ27JsCtB.lottie" background="transparent" speed="1" loop autoplay style="width: 200px; height: 200px;"></dotlottie-player>
        </div>
    </div>

    <div class="containers" style="height: 100vh;font-family: Arial, sans-serif;display: flex;flex-direction: column;align-items: center;justify-content: center;padding-top: 100px;">
        
        <h1>2048 Game</h1>
        <div class="scoreboard">
            <div>Score: <span id="score">0</span></div>
            <div>Best: <span id="best-score">0</span></div>
        </div>
        <div class="board" id="board"></div>
        <p>Use arrow keys to play.</p>
        <button id="try-again" style="display: none;">Try Again</button>
    </div>


    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const boardElement = document.getElementById("board");
            const scoreElement = document.getElementById("score");
            const bestScoreElement = document.getElementById("best-score");
            let board = Array(4).fill().map(() => Array(4).fill(0));
            let tileElements = {};
            let score = 0;
            let bestScore = localStorage.getItem("bestScore") || 0;
            bestScoreElement.textContent = bestScore;
            // Tile colors based on number
            const tileColors = {
                2: "#eee4da",
                4: "#ede0c8",
                8: "#f2b179",
                16: "#f59563",
                32: "#f67c5f",
                64: "#f65e3b",
                128: "#edcf72",
                256: "#FFE600",
                512: "#edc850",
                1024: "#edc53f",
                2048: "#edc22e",
            };
            function updateScore(points) {
                score += points;
                scoreElement.textContent = score;
                if (score > bestScore) {
                    bestScore = score;
                    bestScoreElement.textContent = bestScore;
                    localStorage.setItem("bestScore", bestScore);
                }
            }
            function drawBoard() {
                Object.values(tileElements).forEach(tile => tile.remove());
                tileElements = {};
                board.forEach((row, r) => {
                    row.forEach((value, c) => {
                        if (value !== 0) {
                            let tile = document.createElement("div");
                            tile.classList.add("tile");
                            tile.textContent = value;
                            tile.style.transform = `translate(${c * 110}px, ${r * 110}px)`;
                            tile.style.backgroundColor = tileColors[value] || "#ccc"; // Set color based on value
                            boardElement.appendChild(tile);
                            tileElements[`${r}-${c}`] = tile;
                        }
                    });
                });
            }
            function updateTilePositions() {
                Object.entries(tileElements).forEach(([key, tile]) => {
                    const [r, c] = key.split('-').map(Number);
                    tile.style.transform = `translate(${c * 110}px, ${r * 110}px)`;
                });
            }
            function addRandomTile() {
                let emptyCells = [];
                for (let r = 0; r < 4; r++) {
                    for (let c = 0; c < 4; c++) {
                        if (board[r][c] === 0) emptyCells.push({ r, c });
                    }
                }
                if (emptyCells.length > 0) {
                    let { r, c } = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                    board[r][c] = Math.random() < 0.9 ? 2 : 4;
                }
            }
            function slide(row) {
                let newRow = row.filter(val => val);
                for (let i = 0; i < newRow.length - 1; i++) {
                    if (newRow[i] === newRow[i + 1]) {
                        newRow[i] *= 2;
                        updateScore(newRow[i]);
                        newRow[i + 1] = 0;
                    }
                }
                newRow = newRow.filter(val => val);
                while (newRow.length < 4) newRow.push(0);
                return newRow;
            }
            function reverse(row) {
                return row.reverse();
            }
            function rotateBoardClockwise() {
                let newBoard = Array(4).fill().map(() => Array(4).fill(0));
                for (let r = 0; r < 4; r++) {
                    for (let c = 0; c < 4; c++) {
                        newBoard[c][3 - r] = board[r][c];
                    }
                }
                return newBoard;
            }
            function rotateBoardCounterClockwise() {
                let newBoard = Array(4).fill().map(() => Array(4).fill(0));
                for (let r = 0; r < 4; r++) {
                    for (let c = 0; c < 4; c++) {
                        newBoard[3 - c][r] = board[r][c];
                    }
                }
                return newBoard;
            }
            function moveBoard(direction) {
                let moved = false;
                if (direction === "ArrowUp") {
                    board = rotateBoardCounterClockwise();
                } else if (direction === "ArrowDown") {
                    board = rotateBoardClockwise();
                } else if (direction === "ArrowRight") {
                    board = board.map(reverse);
                }
               
                for (let i = 0; i < 4; i++) {
                    let newRow = slide(board[i]);
                    if (newRow.toString() !== board[i].toString()) moved = true;
                    board[i] = newRow;
                }
               
                if (direction === "ArrowUp") {
                    board = rotateBoardClockwise();
                } else if (direction === "ArrowDown") {
                    board = rotateBoardCounterClockwise();
                } else if (direction === "ArrowRight") {
                    board = board.map(reverse);
                }
               
                if (moved) {
                    addRandomTile();
                    updateTilePositions();
                    setTimeout(drawBoard, 150);
                }
            }
            document.addEventListener("keydown", (event) => {
                if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(event.key)) {
                    moveBoard(event.key);
                }
            });
            const tryAgainButton = document.getElementById("try-again");

            // Function to check if moves are possible
            function hasValidMoves() {
                for (let r = 0; r < 4; r++) {
                    for (let c = 0; c < 4; c++) {
                        if (board[r][c] === 0) return true; // Empty space available

                    // Check horizontal and vertical moves
                        if (c < 3 && board[r][c] === board[r][c + 1]) return true;
                        if (r < 3 && board[r][c] === board[r + 1][c]) return true;
                    }
                }
                return false; // No valid moves left
            }

            // Function to check game over
            function checkGameOver() {
                if (!hasValidMoves()) {
                    tryAgainButton.style.display = "block"; // Show the button
                }
            }

            // Function to restart the game
            function restartGame() {
                board = Array(4).fill().map(() => Array(4).fill(0));
                score = 0;
                scoreElement.textContent = score;
                tryAgainButton.style.display = "none"; // Hide button
                addRandomTile();
                addRandomTile();
                drawBoard();
            }

            // Add event listener for try again button
            tryAgainButton.addEventListener("click", restartGame);

            // Modify moveBoard function to check for game over after each move
            function moveBoard(direction) {
                let moved = false;

                if (direction === "ArrowUp") {
                    board = rotateBoardCounterClockwise();
                } else if (direction === "ArrowDown") {
                    board = rotateBoardClockwise();
                } else if (direction === "ArrowRight") {
                    board = board.map(reverse);
                }

                for (let i = 0; i < 4; i++) {
                    let newRow = slide(board[i]);
                    if (newRow.toString() !== board[i].toString()) moved = true;
                    board[i] = newRow;
                }

                if (direction === "ArrowUp") {
                    board = rotateBoardClockwise();
                } else if (direction === "ArrowDown") {
                    board = rotateBoardCounterClockwise();
                } else if (direction === "ArrowRight") {
                    board = board.map(reverse);
                }

                if (moved) {
                    addRandomTile();
                    updateTilePositions();
                    setTimeout(drawBoard, 150);
                }

                setTimeout(checkGameOver, 200); // Check for game over after move
            }

            let lastMilestone = 0; // Tracks last 1000-point milestone

            function updateScore(points) {
            score += points;
            scoreElement.textContent = score;

                if (score > bestScore) {
                    bestScore = score;
                    bestScoreElement.textContent = bestScore;
                    localStorage.setItem("bestScore", bestScore);
                }

                // Check if the user reached a new 1000-point milestone
                if (Math.floor(score / 1000) > lastMilestone) {
                    lastMilestone = Math.floor(score / 1000);
                    awardBonusPoints();
                }
            }

            function awardBonusPoints() {
                score += 10; // Add 10 bonus points
                scoreElement.textContent = score;
            
                // Show alert
                alert(`🎉 Congrats! You've earned 10 bonus points for reaching ${lastMilestone * 1000} points!`);

                // Simulate API call to update user points
                saveUserPoints(userID, score);
            }

            function saveUserPoints(userID, score) {
                console.log(`✅ Saving points for ${userID}: ${score}`); 
                // Here, you’d send a request to your backend API to update user points.
            }
            addRandomTile();
            addRandomTile();
            drawBoard();
        });
    </script>

    <script src="script.js"></script>
    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
</body>
</html>
